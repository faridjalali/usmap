<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maps Quiz</title>
    
    <link rel="icon" href="icon_0.jpg" type="image/jpeg">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    
    <style>
        :root {
            --bg-deep: #050505;
            --map-stroke: rgba(255, 255, 255, 0.15);
            --neon-blue: #00f3ff;
            --neon-pink: #ff0055;
            --neon-green: #00ff9d;
            --neon-amber: #ffaa00;
            --glass: rgba(15, 15, 15, 0.85);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            
            /* Regional Colors (40% Opacity) */
            --c-southwest: rgba(255, 153, 153, 0.40);
            --c-western: rgba(153, 255, 153, 0.40);
            --c-northeast: rgba(153, 204, 255, 0.40);
            --c-midwest: rgba(255, 204, 153, 0.40);
            --c-southeast: rgba(210, 180, 140, 0.40);
        }

        body {
            margin: 0;
            background-color: var(--bg-deep);
            color: white;
            font-family: var(--font-main);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            user-select: none;
            touch-action: none;
        }

        #map-stage { width: 100%; height: 100%; cursor: crosshair; }

        .state {
            stroke: var(--map-stroke);
            stroke-width: 0.5px;
            transition: fill 0.3s ease, opacity 0.3s ease;
            vector-effect: non-scaling-stroke;
        }

        .reg-southwest { fill: var(--c-southwest); }
        .reg-western { fill: var(--c-western); }
        .reg-northeast { fill: var(--c-northeast); }
        .reg-midwest { fill: var(--c-midwest); }
        .reg-southeast { fill: var(--c-southeast); }

        .state:hover { opacity: 0.8; stroke: rgba(255,255,255,0.4); }
        .state.active-focused { opacity: 1; stroke: #fff; stroke-width: 2px; }

        .state.correct-flash { animation: flashSuccess 0.5s forwards; }
        .state.wrong-flash { animation: flashError 0.5s forwards; }

        @keyframes flashSuccess { 0% { fill: var(--neon-green); opacity: 1; } 100% { fill: inherit; opacity: 0.25; } }
        @keyframes flashError { 0% { fill: var(--neon-pink); opacity: 1; } 100% { fill: inherit; opacity: 0.25; } }

        .city-node {
            fill: var(--neon-blue);
            stroke: rgba(0, 243, 255, 0.2);
            stroke-width: 5px; 
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: none; 
        }

        .city-node:hover { fill: #fff; stroke: var(--neon-blue); stroke-width: 8px; }
        .city-node.wrong-choice { fill: var(--neon-pink); stroke: var(--neon-pink); pointer-events: none; opacity: 0.6; }
        .city-node.correct-choice { fill: var(--neon-green); stroke: var(--neon-green); }

        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }

        #top-hud {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
            padding: 10px 30px; border-radius: 50px; display: flex; gap: 40px;
            backdrop-filter: blur(15px); z-index: 10;
        }

        .hud-group { display: flex; flex-direction: column; align-items: center; min-width: 70px; }
        .hud-item { font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 2px; }
        .hud-val { color: var(--neon-blue); font-weight: 800; font-size: 1.2rem; }

        #prompt-container { position: absolute; top: 15%; width: 100%; text-align: center; text-shadow: 0 5px 25px black; }
        #main-prompt { font-size: 2.2rem; font-weight: 900; text-transform: uppercase; margin: 0; transition: all 0.4s; letter-spacing: 1px; }
        #sub-prompt { font-size: 1.1rem; color: var(--neon-blue); margin-top: 8px; letter-spacing: 1px; line-height: 1.4; }

        .wrong-state-highlight { color: var(--neon-amber); font-weight: 800; }

        #city-tooltip {
            position: absolute; background: rgba(0,0,0,0.9); border: 1px solid var(--neon-blue);
            color: white; padding: 5px 12px; border-radius: 4px; font-size: 0.85rem;
            pointer-events: none; opacity: 0; transform: translate(-50%, -150%);
            white-space: nowrap; z-index: 50;
        }

        #fact-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px); z-index: 100; display: flex;
            justify-content: center; align-items: center; opacity: 0;
            pointer-events: none; transition: opacity 0.3s;
        }
        #fact-overlay.show { opacity: 1; pointer-events: auto; }

        .fact-card {
            background: #111; border: 2px solid var(--neon-blue); border-radius: 20px;
            padding: 45px; max-width: 500px; width: 92%; text-align: center;
        }

        .fact-status { font-weight: 800; letter-spacing: 4px; margin-bottom: 12px; font-size: 1.1rem; text-transform: uppercase; }
        .status-correct { color: var(--neon-green); }
        .status-wrong { color: var(--neon-pink); }
        
        .fact-city { font-size: 2.6rem; margin: 0 0 15px; color: white; font-weight: 900; }
        .fact-body { color: #ddd; line-height: 1.7; margin-bottom: 35px; font-size: 1.1rem; }

        .next-btn {
            background: var(--neon-blue); color: #000; border: none;
            padding: 16px 45px; font-weight: 800; border-radius: 40px;
            cursor: pointer; text-transform: uppercase; transition: 0.2s;
        }
        .next-btn:hover { background: white; transform: scale(1.05); }

    </style>
</head>
<body>

    <div id="city-tooltip">City Name</div>
    <div id="map-stage"></div>

    <div id="ui-layer">
        <div id="top-hud">
            <div class="hud-group">
                <span class="hud-item">Target</span>
                <span id="target-state" class="hud-val">--</span>
            </div>
            <div class="hud-group">
                <span class="hud-item">Score</span>
                <span id="score-val" class="hud-val">0</span>
            </div>
        </div>
        <div id="prompt-container">
            <h1 id="main-prompt">Initializing Satellite...</h1>
            <div id="sub-prompt"></div>
        </div>
    </div>

    <div id="fact-overlay">
        <div class="fact-card">
            <div class="fact-status" id="fact-status">Result</div>
            <div class="fact-city" id="fact-city-name">City</div>
            <div class="fact-body" id="fact-text">Fact</div>
            <button class="next-btn" id="next-action-btn">Continue</button>
        </div>
    </div>

    <script>
        const gameData = {
            "AL": { name: "Alabama", region: "southeast", capital: "Montgomery", cities: { "Montgomery": [-86.3077, 32.3792], "Birmingham": [-86.8104, 33.5186], "Mobile": [-88.0399, 30.6954], "Huntsville": [-86.5861, 34.7304], "Tuscaloosa": [-87.5692, 33.2098] }, facts: { "Montgomery": "The 1955 bus boycott here was a catalyst for the American Civil Rights Movement.", "Birmingham": "Known as 'The Magic City' because of its rapid growth as an iron and steel industrial hub.", "Mobile": "The only saltwater port in the state, founded by French colonists in 1702.", "Huntsville": "The birthplace of the Saturn V moon rockets at the Marshall Space Flight Center.", "Tuscaloosa": "A major hub for higher education and healthcare in West Alabama." } },
            "AK": { name: "Alaska", region: "western", capital: "Juneau", cities: { "Juneau": [-134.4197, 58.3019], "Anchorage": [-149.9003, 61.2181], "Fairbanks": [-147.7164, 64.8378], "Sitka": [-135.3300, 57.0531], "Ketchikan": [-131.6461, 55.3422] }, facts: { "Juneau": "Unique among capitals because it has no road access; you must arrive by plane or ferry.", "Anchorage": "Strategic global cargo hub located at the junction of major polar flight routes.", "Fairbanks": "The northernmost major city in the US, known for its extreme seasonal light changes.", "Sitka": "The capital of Russian America before the US purchased Alaska in 1867.", "Ketchikan": "The 'Salmon Capital of the World' and center for Tlingit and Haida indigenous culture." } },
            "AZ": { name: "Arizona", region: "southwest", capital: "Phoenix", cities: { "Phoenix": [-112.0740, 33.4484], "Tucson": [-110.9747, 32.2226], "Mesa": [-111.8315, 33.4152], "Scottsdale": [-111.9261, 33.4942], "Flagstaff": [-111.6513, 35.1983] }, facts: { "Phoenix": "The largest state capital by population and a center for high-tech manufacturing.", "Tucson": "Located near the Sonoran Desert, it hosts the oldest Spanish mission in the state.", "Mesa": "A major desert suburb with an economy driven by aerospace and education.", "Scottsdale": "World famous for Western art galleries and arid-climate botanical research.", "Flagstaff": "Gateway to the San Francisco Peaks and a hub for atmospheric science." } },
            "AR": { name: "Arkansas", region: "southeast", capital: "Little Rock", cities: { "Little Rock": [-92.2896, 34.7465], "Fayetteville": [-94.1574, 36.0626], "Fort Smith": [-94.4229, 35.3859], "Springdale": [-94.1288, 36.1867], "Hot Springs": [-93.0552, 34.5037] }, facts: { "Little Rock": "Site of the 1957 integration crisis at Central High School, a key civil rights event.", "Fayetteville": "Rapidly growing economic center in the Ozark Mountains region.", "Fort Smith": "Established as a western frontier military post in 1817.", "Springdale": "Global headquarters for Tyson Foods and a key center for the poultry industry.", "Hot Springs": "Famous for thermal springs protected by the first federal land reservation in 1832." } },
            "CA": { name: "California", region: "western", capital: "Sacramento", cities: { "Sacramento": [-121.4944, 38.5816], "Los Angeles": [-118.2437, 34.0522], "San Francisco": [-122.4194, 37.7749], "San Diego": [-117.1611, 32.7157], "San Jose": [-121.8863, 37.3382] }, facts: { "Sacramento": "The terminus of the First Transcontinental Railroad and a key 1849 Gold Rush hub.", "Los Angeles": "The second most populous US city and a global capital for the media industry.", "San Francisco": "A financial center built on a peninsula, famous for its steep hills and fog.", "San Diego": "Home to the Pacific Fleet and a major center for oceanographic research.", "San Jose": "The technological heart of Silicon Valley and the original capital of the state." } },
            "CO": { name: "Colorado", region: "western", capital: "Denver", cities: { "Denver": [-104.9903, 39.7392], "Colorado Springs": [-104.8214, 38.8339], "Aurora": [-104.8319, 39.7294], "Fort Collins": [-105.0844, 40.5853], "Boulder": [-105.2705, 40.0150] }, facts: { "Denver": "Founded during the Pikes Peak Gold Rush, it sits exactly one mile above sea level.", "Colorado Springs": "Base of the US Air Force Academy and a hub for high-altitude athletic training.", "Aurora": "A major modern transportation and medical research hub for the Rocky Mountains.", "Fort Collins": "Leading center for agricultural research and water resource management.", "Boulder": "Nestled at the base of the Flatirons, it is a global center for climate research." } },
            "CT": { name: "Connecticut", region: "northeast", capital: "Hartford", cities: { "Hartford": [-72.6734, 41.7658], "Bridgeport": [-73.1894, 41.1792], "New Haven": [-72.9279, 41.3083], "Stamford": [-73.5387, 41.0534], "Waterbury": [-73.0454, 41.5582] }, facts: { "Hartford": "Known as the Insurance Capital of the World since the early 1800s.", "Bridgeport": "The largest city in the state, originally a 19th-century manufacturing powerhouse.", "New Haven": "Home to Yale University and the birthplace of the modern planned city layout.", "Stamford": "Major regional financial hub within the Greater New York metropolitan area.", "Waterbury": "Known as the 'Brass City' for its historical dominance in metal manufacturing." } },
            "DE": { name: "Delaware", region: "northeast", capital: "Dover", cities: { "Dover": [-75.5297, 39.1582], "Wilmington": [-75.5484, 39.7447], "Newark": [-75.7497, 39.6837], "Middletown": [-75.7163, 39.4496], "Smyrna": [-75.6049, 39.2998] }, facts: { "Dover": "Founded in 1683, it serves as a major military and legal center.", "Wilmington": "A national hub for corporate law and the domestic chemical industry.", "Newark": "Major educational center and formerly home to a large automotive plant.", "Middletown": "Transitioned from a rural agricultural village to a fast-growing tech suburb.", "Smyrna": "A historic shipping town named after a famous Biblical city in the Aegean." } },
            "FL": { name: "Florida", region: "southeast", capital: "Tallahassee", cities: { "Tallahassee": [-84.2807, 30.4383], "Miami": [-80.1918, 25.7617], "Orlando": [-81.3792, 28.5383], "Tampa": [-82.4572, 27.9506], "Jacksonville": [-81.6557, 30.3322] }, facts: { "Tallahassee": "Located on the Red Hills, it was chosen as capital for being halfway between older ports.", "Miami": "A major center for international finance and the 'Gateway to the Americas'.", "Orlando": "World-famous tourism hub with an economy built on theme parks and hospitality.", "Tampa": "Major deep-water port on the Gulf of Mexico and center for the cigar industry.", "Jacksonville": "The largest US city by land area and a major military and logistics port." } },
            "GA": { name: "Georgia", region: "southeast", capital: "Atlanta", cities: { "Atlanta": [-84.3880, 33.7490], "Savannah": [-81.0998, 32.0809], "Augusta": [-81.9748, 33.4735], "Macon": [-83.6324, 32.8407], "Columbus": [-84.9901, 32.4610] }, facts: { "Atlanta": "International transport hub and the headquarters for many Fortune 500 companies.", "Savannah": "The first capital of Georgia, famous for its historic British-colonial layout.", "Augusta": "Strategic city on the Savannah River and host of the Masters golf tournament.", "Macon": "A center for music history and the heart of Georgia's agricultural region.", "Columbus": "Industrial city home to Fort Moore, one of the Army's largest training bases." } },
            "HI": { name: "Hawaii", region: "western", capital: "Honolulu", cities: { "Honolulu": [-157.8583, 21.3069], "Hilo": [-155.0844, 19.7297], "Kailua": [-157.7394, 21.4022], "Kapolei": [-158.0772, 21.3328], "Lihue": [-159.3711, 21.9811] }, facts: { "Honolulu": "Home to Iolani Palace, the only royal palace on US soil.", "Hilo": "Known for its proximity to active volcanoes and heavy tropical rainfall.", "Kailua": "A windward city famous for marine conservation and pristine beaches.", "Kapolei": "Designed as Oahu's 'Second City' to decentralize government from Honolulu.", "Lihue": "The administrative heart of the island of Kauai." } },
            "ID": { name: "Idaho", region: "western", capital: "Boise", cities: { "Boise": [-116.2023, 43.6150], "Meridian": [-116.3915, 43.6121], "Nampa": [-116.5635, 43.5407], "Idaho Falls": [-112.0340, 43.4917], "Pocatello": [-112.4506, 42.8666] }, facts: { "Boise": "A center for high-tech industry and the hub of the Treasure Valley.", "Meridian": "One of the fastest-growing cities in the US, known for its service economy.", "Nampa": "A food processing hub located in the middle of a rich agricultural valley.", "Idaho Falls": "Center for nuclear energy research and the gateway to the Snake River.", "Pocatello": "A major historical railway crossroads between Utah and the Pacific." } },
            "IL": { name: "Illinois", region: "midwest", capital: "Springfield", cities: { "Springfield": [-89.6501, 39.7817], "Chicago": [-87.6298, 41.8781], "Aurora": [-88.3156, 41.7606], "Rockford": [-89.0939, 42.2711], "Joliet": [-88.0817, 41.5250] }, facts: { "Springfield": "The burial place of Abraham Lincoln and a center for Illinois state politics.", "Chicago": "The historic heart of US rail and commodity trading on the Great Lakes.", "Aurora": "One of the first US cities to adopt an all-electric street lighting system.", "Rockford": "A major industrial city with an economy driven by aerospace manufacturing.", "Joliet": "A historic canal town and the site of the first US Dairy Queen." } },
            "IN": { name: "Indiana", region: "midwest", capital: "Indianapolis", cities: { "Indianapolis": [-86.1581, 39.7684], "Fort Wayne": [-85.1394, 41.0793], "Evansville": [-87.5711, 37.9716], "South Bend": [-86.2520, 41.6764], "Gary": [-87.3464, 41.5940] }, facts: { "Indianapolis": "Features more war memorials than any US city except Washington, D.C.", "Fort Wayne": "Established as a military fort to control travel on the Great Lakes system.", "Evansville": "Commercial hub for the Ohio River region and southern Indiana.", "South Bend": "Historic center for the American automotive industry (Studebaker).", "Gary": "Founded in 1906 by US Steel, it was once a model industrial city." } },
            "IA": { name: "Iowa", region: "midwest", capital: "Des Moines", cities: { "Des Moines": [-93.6091, 41.6005], "Cedar Rapids": [-91.6656, 41.9779], "Davenport": [-90.5776, 41.5236], "Sioux City": [-96.4103, 42.4999], "Iowa City": [-91.5302, 41.6611] }, facts: { "Des Moines": "A global epicenter for the insurance industry and agricultural finance.", "Cedar Rapids": "Home to Quaker Oats, one of the world's largest cereal milling plants.", "Davenport": "One of the 'Quad Cities' and a major manufacturing hub on the Mississippi.", "Sioux City": "Key historical river port for travel across the Great Plains.", "Iowa City": "The original state capital and home to the renowned Iowa Writers' Workshop." } },
            "KS": { name: "Kansas", region: "midwest", capital: "Topeka", cities: { "Topeka": [-95.6890, 39.0473], "Wichita": [-97.3301, 37.6872], "Overland Park": [-94.6708, 38.9822], "Kansas City": [-94.6274, 39.1140], "Lawrence": [-95.2353, 38.9717] }, facts: { "Topeka": "Site of the 1954 Supreme Court case that ended legal school segregation.", "Wichita": "The 'Air Capital of the World' due to its aircraft manufacturing history.", "Overland Park": "A major corporate service hub for the Kansas City metropolitan area.", "Kansas City": "A center for logistics, rail transport, and famous Midwestern barbecue.", "Lawrence": "A city founded by abolitionists to ensure Kansas became a free state." } },
            "KY": { name: "Kentucky", region: "southeast", capital: "Frankfort", cities: { "Frankfort": [-84.8705, 38.2009], "Louisville": [-85.7585, 38.2527], "Lexington": [-84.5037, 38.0406], "Bowling Green": [-86.4436, 36.9685], "Owensboro": [-87.1181, 37.7719] }, facts: { "Frankfort": "The fourth smallest US capital, divided by the scenic Kentucky River.", "Louisville": "Strategic Ohio River port and birthplace of the Kentucky Derby.", "Lexington": "Located in the heart of the Bluegrass region, the Horse Capital of the World.", "Bowling Green": "Home to the manufacturing plant for the iconic Chevrolet Corvette.", "Owensboro": "A major river port and center for the state's agriculture and barbecue." } },
            "LA": { name: "Louisiana", region: "southeast", capital: "Baton Rouge", cities: { "Baton Rouge": [-91.1403, 30.4583], "New Orleans": [-90.0715, 29.9511], "Shreveport": [-93.7502, 32.5252], "Lafayette": [-92.0198, 30.2241], "Lake Charles": [-93.2174, 30.2265] }, facts: { "Baton Rouge": "French for 'Red Stick,' it is a major industrial hub on the Mississippi.", "New Orleans": "One of the world's most historic ports and the birthplace of Jazz.", "Shreveport": "A strategic river city located at the crossroads of Texas, Louisiana, and Arkansas.", "Lafayette": "The cultural heart of Louisiana's Cajun and Creole heritage.", "Lake Charles": "Major center for the petrochemical industry and Louisiana's gaming sector." } },
            "ME": { name: "Maine", region: "northeast", capital: "Augusta", cities: { "Augusta": [-69.7795, 44.3106], "Portland": [-70.2568, 43.6591], "Lewiston": [-70.2148, 44.1004], "Bangor": [-68.7778, 44.8016], "Auburn": [-70.2312, 44.0979] }, facts: { "Augusta": "The easternmost state capital in the US, first established as a trading post.", "Portland": "The largest city in Maine, known for its historic working waterfront.", "Lewiston": "Historically a center for French-Canadian immigration and textile mills.", "Bangor": "A legendary timber shipping hub and gateway to the Maine North Woods.", "Auburn": "A major industrial city known as the shoe-making capital of Maine." } },
            "MD": { name: "Maryland", region: "northeast", capital: "Annapolis", cities: { "Annapolis": [-76.4922, 38.9784], "Baltimore": [-76.6122, 39.2904], "Frederick": [-77.4105, 39.4143], "Gaithersburg": [-77.1944, 39.1434], "Ocean City": [-75.0849, 38.3365] }, facts: { "Annapolis": "Site where George Washington resigned as Commander of the Continental Army.", "Baltimore": "A major historic port city where the US National Anthem was written.", "Frederick": "A historic frontier crossroads that played key roles in the Civil War.", "Gaithersburg": "Center for biotechnology research and the US government's NIST laboratories.", "Ocean City": "Maryland's premier seaside resort, known for its long wooden boardwalk." } },
            "MA": { name: "Massachusetts", region: "northeast", capital: "Boston", cities: { "Boston": [-71.0589, 42.3601], "Worcester": [-71.8023, 42.2626], "Springfield": [-72.5898, 42.1015], "Cambridge": [-71.1097, 42.3736], "Lowell": [-71.3162, 42.6334] }, facts: { "Boston": "The 'Cradle of Liberty' and home to the first US public subway and school.", "Worcester": "Strategic industrial city where the liquid-fuel rocket was first invented.", "Springfield": "Birthplace of basketball and site of the first US national armory.", "Cambridge": "Home to the oldest university in the US, founded in 1636.", "Lowell": "One of the first planned industrial cities in the US, built around textile mills." } },
            "MI": { name: "Michigan", region: "midwest", capital: "Lansing", cities: { "Lansing": [-84.5555, 42.7325], "Detroit": [-83.0458, 42.3314], "Grand Rapids": [-85.6681, 42.9634], "Ann Arbor": [-83.7430, 42.2808], "Flint": [-83.6875, 43.0125] }, facts: { "Lansing": "An industrial and political center located in the center of the Lower Peninsula.", "Detroit": "The 'Motor City,' which transformed the world through mass production of cars.", "Grand Rapids": "Major global center for furniture design and manufacturing.", "Ann Arbor": "Leading center for medical research and the automotive testing industry.", "Flint": "The original birthplace of General Motors and a pioneer in industrial labor unionism." } },
            "MN": { name: "Minnesota", region: "midwest", capital: "Saint Paul", cities: { "Saint Paul": [-93.0899, 44.9537], "Minneapolis": [-93.2650, 44.9778], "Rochester": [-92.4802, 44.0121], "Duluth": [-92.1005, 46.7867], "Bloomington": [-93.2983, 44.8408] }, facts: { "Saint Paul": "A major river port and commercial hub adjacent to the headwaters of the Mississippi.", "Minneapolis": "Major grain processing center that was once the 'Flour Milling Capital of the World'.", "Rochester": "Global center for medical innovation and home to the Mayo Clinic.", "Duluth": "The world's most inland freshwater port on the tip of Lake Superior.", "Bloomington": "Home to the Mall of America and a major hub for Midwestern tourism." } },
            "MS": { name: "Mississippi", region: "southeast", capital: "Jackson", cities: { "Jackson": [-90.1848, 32.2988], "Gulfport": [-89.0928, 30.3674], "Biloxi": [-88.8853, 30.3960], "Hattiesburg": [-89.2903, 31.3271], "Tupelo": [-88.7034, 34.2576] }, facts: { "Jackson": "Built on the site of a dormant volcano and named for the 7th US President.", "Gulfport": "A major export harbor for the US Southeast and home to Navy Seabees.", "Biloxi": "Founded by French explorers in 1699, it's one of the oldest cities on the Gulf Coast.", "Hattiesburg": "Known as the 'Hub City' because of its central crossroads of rails and roads.", "Tupelo": "The first city in the US to utilize electric power from the TVA." } },
            "MO": { name: "Missouri", region: "midwest", capital: "Jefferson City", cities: { "Jefferson City": [-92.1735, 38.5767], "Kansas City": [-94.5786, 39.0997], "St. Louis": [-90.1994, 38.6270], "Springfield": [-93.2923, 37.2089], "Branson": [-93.2185, 36.6437] }, facts: { "Jefferson City": "Named for Thomas Jefferson and built on bluffs overlooking the Missouri River.", "Kansas City": "Features an extensive park system modeled after the city of Rome.", "St. Louis": "The 'Gateway to the West' and site of the start of the Lewis and Clark expedition.", "Springfield": "Industrial hub known as the 'Queen City of the Ozarks'.", "Branson": "A top US destination for live music shows and entertainment in the mountains." } },
            "MT": { name: "Montana", region: "western", capital: "Helena", cities: { "Helena": [-112.0270, 46.5891], "Billings": [-108.5007, 45.7833], "Missoula": [-113.9966, 46.8721], "Great Falls": [-111.3218, 47.5053], "Bozeman": [-111.0429, 45.6770] }, facts: { "Helena": "A boomtown that once had more millionaires per capita than any city in the world.", "Billings": "The commercial hub of the Northern Plains, surrounded by sandstone cliffs.", "Missoula": "Home to the smokejumpers who battle wildfires across the West.", "Great Falls": "The 'Electric City' named for the five massive dams on the Missouri River.", "Bozeman": "Gateway to Yellowstone and a major hub for agricultural and technology research." } },
            "NE": { name: "Nebraska", region: "midwest", capital: "Lincoln", cities: { "Lincoln": [-96.7026, 40.8136], "Omaha": [-95.9345, 41.2565], "Bellevue": [-95.9403, 41.1578], "Grand Island": [-98.3414, 40.9264], "Kearney": [-99.0817, 40.6995] }, facts: { "Lincoln": "Named for Abraham Lincoln and home to the unique one-house state legislature.", "Omaha": "Terminus for the Union Pacific railroad and a major hub for the telecommunications industry.", "Bellevue": "The oldest continuous settlement in the state, originally a fur-trading post.", "Grand Island": "A historical stop on the Oregon Trail and a key rail transportation hub.", "Kearney": "The halfway point between Boston and San Francisco on the historic Lincoln Highway." } },
            "NV": { name: "Nevada", region: "western", capital: "Carson City", cities: { "Carson City": [-119.7674, 39.1638], "Las Vegas": [-115.1398, 36.1699], "Henderson": [-114.9817, 36.0395], "Reno": [-119.8138, 39.5296], "Elko": [-115.7631, 40.8324] }, facts: { "Carson City": "A small capital established in 1858 near the famous Comstock Silver Lode.", "Las Vegas": "Global hospitality hub that grew from a small railroad stop in the Mojave Desert.", "Henderson": "Leading center for chemical manufacturing and high-tech defense research.", "Reno": "Known as 'The Biggest Little City in the World,' located on the Truckee River.", "Elko": "The heart of Nevada's massive gold and silver mining industry." } },
            "NH": { name: "New Hampshire", region: "northeast", capital: "Concord", cities: { "Concord": [-71.5376, 43.2081], "Manchester": [-71.4548, 42.9956], "Nashua": [-71.4676, 42.7654], "Derry": [-71.3273, 42.8806], "Portsmouth": [-70.7626, 43.0718] }, facts: { "Concord": "Known for the granite quarries that built many of the nation's monuments.", "Manchester": "Once home to the world's largest textile mill complex during the Industrial Revolution.", "Nashua": "Historically driven by the textile and paper industries on the Merrimack River.", "Derry": "Birthplace of Alan Shepard, the first American in space.", "Portsmouth": "Strategic colonial port and home to the first US naval shipyard." } },
            "NJ": { name: "New Jersey", region: "northeast", capital: "Trenton", cities: { "Trenton": [-74.7429, 40.2206], "Newark": [-74.1724, 40.7357], "Jersey City": [-74.0431, 40.7178], "Paterson": [-74.1718, 40.9168], "Atlantic City": [-74.4229, 39.3643] }, facts: { "Trenton": "Site of George Washington's critical 1776 victory after crossing the Delaware River.", "Newark": "Major global transportation hub and home to the nation's largest insurance companies.", "Jersey City": "A diverse historic gateway for immigrants arriving at nearby Ellis Island.", "Paterson": "The nation's first planned industrial city, known for its silk and textile production.", "Atlantic City": "Famous for the world's first boardwalk and as the setting for the game Monopoly." } },
            "NM": { name: "New Mexico", region: "southwest", capital: "Santa Fe", cities: { "Santa Fe": [-105.9378, 35.6870], "Albuquerque": [-106.6056, 35.0844], "Las Cruces": [-106.7785, 32.3199], "Rio Rancho": [-106.6622, 35.2328], "Roswell": [-104.5230, 33.3943] }, facts: { "Santa Fe": "Established in 1610, it is the oldest state capital in the United States.", "Albuquerque": "Strategic high-altitude center for aerospace and nuclear physics research.", "Las Cruces": "Located in the Mesilla Valley and home to White Sands Missile Range research.", "Rio Rancho": "A fast-growing technological hub and corporate service center for the Southwest.", "Roswell": "A historically significant military and ranching center in the Pecos River Valley." } },
            "NY": { name: "New York", region: "northeast", capital: "Albany", cities: { "Albany": [-73.7562, 42.6526], "New York City": [-74.0060, 40.7128], "Buffalo": [-78.8784, 42.8864], "Rochester": [-77.6109, 43.1610], "Syracuse": [-76.1474, 43.0481] }, facts: { "Albany": "One of the oldest surviving colonial settlements, built as a strategic Hudson River fur-trading post.", "New York City": "Global capital for finance and the headquarters of the United Nations.", "Buffalo": "Terminus of the Erie Canal, which connected the Great Lakes to the Atlantic Ocean.", "Rochester": "Known as the 'Image Capital of the World' for its history in optics and photography.", "Syracuse": "An industrial crossroads known historically as the 'Salt City'." } },
            "NC": { name: "North Carolina", region: "southeast", capital: "Raleigh", cities: { "Raleigh": [-78.6382, 35.7796], "Charlotte": [-80.8431, 35.2271], "Greensboro": [-79.7920, 36.0726], "Durham": [-78.8986, 35.9940], "Winston-Salem": [-80.2442, 36.0999] }, facts: { "Raleigh": "The 'City of Oaks' and a key part of the Research Triangle tech region.", "Charlotte": "The largest city in the state and the second-largest financial center in the US.", "Greensboro": "Site of major Revolutionary War battles and Civil Rights milestones.", "Durham": "A leading medical research center known as the 'City of Medicine'.", "Winston-Salem": "The historic heart of the American tobacco and textile manufacturing industry." } },
            "ND": { name: "North Dakota", region: "midwest", capital: "Bismarck", cities: { "Bismarck": [-100.7837, 46.8083], "Fargo": [-96.7898, 46.8772], "Grand Forks": [-97.0329, 47.9253], "Minot": [-101.2963, 48.2325], "Williston": [-103.6256, 48.1470] }, facts: { "Bismarck": "Founded in 1872 on the Missouri River as a gateway to the Northern Frontier.", "Fargo": "The state's largest city and a major hub for retail and food science research.", "Grand Forks": "Home to one of the world's leading centers for aerospace and unmanned aircraft research.", "Minot": "A strategic logistics hub and host of a major US nuclear defense base.", "Williston": "The primary center for the Bakken oil boom and Western North Dakota's energy sector." } },
            "OH": { name: "Ohio", region: "midwest", capital: "Columbus", cities: { "Columbus": [-82.9988, 39.9612], "Cleveland": [-81.6944, 41.4993], "Cincinnati": [-84.5120, 39.1031], "Toledo": [-83.5552, 41.6528], "Akron": [-81.5190, 41.0814] }, facts: { "Columbus": "A fast-growing educational and logistics center in the heart of the Midwest.", "Cleveland": "Major manufacturing city and home to one of the world's top medical centers.", "Cincinnati": "Historic river city that was the first major US city founded after the Revolution.", "Toledo": "Known as the 'Glass City' due to its long history as a glass-manufacturing powerhouse.", "Akron": "Known as the 'Rubber Capital of the World' for its history in tire manufacturing." } },
            "OK": { name: "Oklahoma", region: "southwest", capital: "Oklahoma City", cities: { "Oklahoma City": [-97.5164, 35.4676], "Tulsa": [-95.9928, 36.1540], "Norman": [-97.4395, 35.2226], "Broken Arrow": [-95.7908, 36.0526], "Lawton": [-98.3903, 34.6036] }, facts: { "Oklahoma City": "Grew by 10,000 people in a single day during the Land Run of 1889.", "Tulsa": "A former oil capital once known as the 'Oil Capital of the World'.", "Norman": "Home to the National Weather Center, which monitors severe storms for the US.", "Broken Arrow": "Leading industrial suburb and center for agricultural tool manufacturing.", "Lawton": "Located near Fort Sill, the US Army's historic artillery training center." } },
            "OR": { name: "Oregon", region: "western", capital: "Salem", cities: { "Salem": [-123.0351, 44.9429], "Portland": [-122.6784, 45.5152], "Eugene": [-123.0868, 44.0521], "Gresham": [-122.4312, 45.4985], "Medford": [-122.8752, 42.3265] }, facts: { "Salem": "Grew as an agricultural hub for the rich soil of the Willamette Valley.", "Portland": "Strategic port city located at the junction of the Willamette and Columbia rivers.", "Eugene": "A global center for athletic innovation and timber research.", "Gresham": "A major logistics hub located at the gateway to the Columbia River Gorge.", "Medford": "Commercial center for Southern Oregon's pear and timber industries." } },
            "PA": { name: "Pennsylvania", region: "northeast", capital: "Harrisburg", cities: { "Harrisburg": [-76.8867, 40.2732], "Philadelphia": [-75.1652, 39.9526], "Pittsburgh": [-79.9959, 40.4406], "Allentown": [-75.4902, 40.6023], "Erie": [-80.0850, 42.1292] }, facts: { "Harrisburg": "Strategic railroad hub that was a major target during the Civil War.", "Philadelphia": "Site of the signing of the Declaration of Independence and the Constitution.", "Pittsburgh": "The 'Steel City' that produced the metal for much of the nation's infrastructure.", "Allentown": "A major 19th-century center for iron and silk production.", "Erie": "Pennsylvania's only Great Lakes port, once a major shipbuilding center." } },
            "RI": { name: "Rhode Island", region: "northeast", capital: "Providence", cities: { "Providence": [-71.4128, 41.8240], "Warwick": [-71.4162, 41.7001], "Cranston": [-71.4406, 41.7798], "Pawtucket": [-71.3824, 41.8787], "Newport": [-71.3128, 41.4901] }, facts: { "Providence": "Founded by Roger Williams in 1636 as a haven for religious freedom.", "Warwick": "Location of the 1772 Gaspee Affair, a key act of resistance against British rule.", "Cranston": "A hub for textiles that transitioned into a major suburban service center.", "Pawtucket": "The birthplace of the American Industrial Revolution at Slater Mill.", "Newport": "Historic maritime center and famous Gilded Age summer resort." } },
            "SC": { name: "South Carolina", region: "southeast", capital: "Columbia", cities: { "Columbia": [-81.0348, 34.0007], "Charleston": [-79.9311, 32.7765], "North Charleston": [-79.9733, 32.8546], "Mount Pleasant": [-79.8600, 32.7935], "Rock Hill": [-81.0251, 34.9249] }, facts: { "Columbia": "Established in 1786 specifically to be the state's centrally located capital.", "Charleston": "The oldest city in the state, founded in 1670 as a major colonial port.", "North Charleston": "A top center for aerospace manufacturing and military logistics.", "Mount Pleasant": "A historic coastal town that protects the entrance to Charleston Harbor.", "Rock Hill": "A former textile town that is now a leading center for recreational technology." } },
            "SD": { name: "South Dakota", region: "midwest", capital: "Pierre", cities: { "Pierre": [-100.3508, 44.3683], "Sioux Falls": [-96.7265, 43.5460], "Rapid City": [-103.2310, 44.0805], "Aberdeen": [-98.4842, 45.4647], "Brookings": [-96.7984, 44.3114] }, facts: { "Pierre": "Named for fur trader Pierre Chouteau and located on the Missouri River.", "Sioux Falls": "Named for the falls of the Big Sioux River, it's a major financial services center.", "Rapid City": "Known as the 'Gateway to the Black Hills' and Mount Rushmore.", "Aberdeen": "Grew as a major distribution center for the Dakota rail lines.", "Brookings": "Home to the state's largest agricultural university and research center." } },
            "TN": { name: "Tennessee", region: "southeast", capital: "Nashville", cities: { "Nashville": [-86.7816, 36.1627], "Memphis": [-90.0490, 35.1495], "Knoxville": [-83.9207, 35.9606], "Chattanooga": [-85.2666, 35.0456], "Clarksville": [-87.3581, 36.5298] }, facts: { "Nashville": "A top center for the US healthcare industry and the 'Music City'.", "Memphis": "The logistics capital of the world and a cornerstone of US music history.", "Knoxville": "The first capital of Tennessee and gateway to the Smoky Mountains.", "Chattanooga": "A major river city that was a decisive rail junction during the Civil War.", "Clarksville": "Strategic city home to the 101st Airborne Division at Fort Campbell." } },
            "TX": { name: "Texas", region: "southwest", capital: "Austin", cities: { "Austin": [-97.7431, 30.2672], "Houston": [-95.3698, 29.7604], "Dallas": [-96.7970, 32.7767], "San Antonio": [-98.4936, 29.4241], "El Paso": [-106.4850, 31.7619] }, facts: { "Austin": "The Live Music Capital of the World and a major technological research hub.", "Houston": "The fourth largest US city and home to NASA's Johnson Space Center.", "Dallas": "A global center for the oil industry and the headquarters of the cotton market.", "San Antonio": "Famous for the Alamo and its history as a colonial Spanish mission center.", "El Paso": "A major international trade gateway located on the Rio Grande border." } },
            "UT": { name: "Utah", region: "western", capital: "Salt Lake City", cities: { "Salt Lake City": [-111.8910, 40.7608], "West Valley City": [-112.0011, 40.6916], "Provo": [-111.6585, 40.2338], "West Jordan": [-111.9391, 40.6097], "Orem": [-111.6946, 40.2969] }, facts: { "Salt Lake City": "Founded by pioneers in 1847 and host of the 2002 Winter Olympics.", "West Valley City": "A major modern industrial and entertainment hub for the Salt Lake Valley.", "Provo": "Leading technological center known as a 'Silicon Slopes' city.", "West Jordan": "Rapidly growing center for commercial aviation and distribution logistics.", "Orem": "Known as the 'Family City,' it's a hub for software and education." } },
            "VT": { name: "Vermont", region: "northeast", capital: "Montpelier", cities: { "Montpelier": [-72.5778, 44.2601], "Burlington": [-73.2121, 44.4759], "Rutland": [-72.9726, 43.6106], "Barre": [-72.5012, 44.1970], "Winooski": [-73.1823, 44.4909] }, facts: { "Montpelier": "The only US state capital without a McDonald's restaurant.", "Burlington": "The first US city to be powered entirely by renewable energy.", "Rutland": "Historical center of the world's marble manufacturing industry.", "Barre": "The 'Granite Capital of the World,' with some of the world's deepest quarries.", "Winooski": "A historic mill city that has become a center for clean-tech innovation." } },
            "VA": { name: "Virginia", region: "southeast", capital: "Richmond", cities: { "Richmond": [-77.4360, 37.5407], "Virginia Beach": [-75.9779, 36.8529], "Norfolk": [-76.2859, 36.8508], "Chesapeake": [-76.2875, 36.7682], "Arlington": [-77.1008, 38.8783] }, facts: { "Richmond": "Capital since 1780 and a major historical center for the US tobacco trade.", "Virginia Beach": "Major hub for nautical research with the world's longest pleasure beach.", "Norfolk": "Home to the world's largest naval station and a major coal port.", "Chesapeake": "Strategic city containing a large portion of the Great Dismal Swamp.", "Arlington": "Home to the Pentagon and Arlington National Cemetery." } },
            "WA": { name: "Washington", region: "western", capital: "Olympia", cities: { "Olympia": [-122.9007, 47.0379], "Seattle": [-122.3321, 47.6062], "Spokane": [-117.4260, 47.6588], "Tacoma": [-122.4443, 47.2529], "Vancouver": [-122.6615, 45.6387] }, facts: { "Olympia": "A major hub for regional maritime trade and environmental science.", "Seattle": "A global leader in aerospace (Boeing) and software (Microsoft).", "Spokane": "A historic rail center and the site of the first environmentally themed World's Fair.", "Tacoma": "Major deep-water port known for international Pacific Rim trade.", "Vancouver": "Established in 1825 as a fur-trading fort, the oldest city in the state." } },
            "WV": { name: "West Virginia", region: "southeast", capital: "Charleston", cities: { "Charleston": [-81.6326, 38.3498], "Huntington": [-82.4451, 38.4193], "Morgantown": [-79.9559, 39.6295], "Parkersburg": [-81.5615, 39.2667], "Wheeling": [-80.7209, 40.0640] }, facts: { "Charleston": "The capitol dome is covered in real gold leaf, a symbol of the state's wealth.", "Huntington": "Historic city that served as the terminus for the Chesapeake and Ohio Railway.", "Morgantown": "Center for medical research and the automated Personal Rapid Transit system.", "Parkersburg": "Historic center for the early American oil and chemical industries.", "Wheeling": "The original capital of West Virginia and a major historic Ohio River port." } },
            "WI": { name: "Wisconsin", region: "midwest", capital: "Madison", cities: { "Madison": [-89.4012, 43.0731], "Milwaukee": [-87.9065, 43.0389], "Green Bay": [-88.0198, 44.5192], "Kenosha": [-87.8212, 42.5847], "Racine": [-87.7829, 42.7261] }, facts: { "Madison": "Built on an isthmus between two lakes, it is a hub for agricultural science.", "Milwaukee": "Grew as a major center for Great Lakes shipping and mechanical engineering.", "Green Bay": "The smallest US city with a major professional sports team (Packers).", "Kenosha": "A historic lake port that transitioned from car-making to tech-logistics.", "Racine": "Known for its history of tool manufacturing and modern industrial design." } },
            "WY": { name: "Wyoming", region: "western", capital: "Cheyenne", cities: { "Cheyenne": [-104.8202, 41.1400], "Casper": [-106.3252, 42.8666], "Laramie": [-105.5911, 41.3114], "Gillette": [-105.5022, 44.2911], "Rock Springs": [-109.2321, 41.5875] }, facts: { "Cheyenne": "Strategic rail city and center for the nation's wind-energy research.", "Casper": "Historic center for the western energy and oil refining industries.", "Laramie": "The only city in the state with a university, a major research center.", "Gillette": "Known as the 'Energy Capital of the Nation' for its vast coal deposits.", "Rock Springs": "Grew as a massive multicultural labor hub during the mining boom." } }
        };

        let svg, g, zoom, projection, path;
        let width, height;
        let currentTargetAbbr = "";
        let currentPhase = "MAP_SELECTION"; 
        let score = 0;
        let cityStrikes = 0;
        let visited = new Set();
        let currentScale = 1;

        window.onload = initGame;

        async function initGame() {
            width = window.innerWidth;
            height = window.innerHeight;
            const container = d3.select("#map-stage");
            svg = container.append("svg").attr("viewBox", `0 0 ${width} ${height}`).attr("preserveAspectRatio", "xMidYMid meet");
            g = svg.append("g");
            zoom = d3.zoom().scaleExtent([1, 15]).on("zoom", (e) => {
                g.attr("transform", e.transform);
                currentScale = e.transform.k;
                d3.selectAll(".city-node").attr("r", 6 / currentScale).attr("stroke-width", (2/currentScale));
            });
            svg.call(zoom);

            try {
                const us = await d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json");
                const stateFeatures = topojson.feature(us, us.objects.states).features;
                projection = d3.geoAlbersUsa().fitSize([width, height], topojson.feature(us, us.objects.states));
                path = d3.geoPath().projection(projection);

                const nameToAbbr = Object.entries(gameData).reduce((acc, [abbr, data]) => { acc[data.name] = abbr; return acc; }, {});

                g.selectAll("path")
                    .data(stateFeatures)
                    .enter().append("path")
                    .attr("d", path)
                    .attr("class", d => {
                        const abbr = nameToAbbr[d.properties.name];
                        const region = gameData[abbr] ? gameData[abbr].region : "unknown";
                        return `state reg-${region}`;
                    })
                    .attr("id", d => {
                        const abbr = nameToAbbr[d.properties.name];
                        return abbr ? `state-${abbr}` : null;
                    })
                    .on("click", handleStateClick);

                startRound();
            } catch (err) { console.error(err); }
        }

        function startRound() {
            const keys = Object.keys(gameData);
            const available = keys.filter(k => !visited.has(k));
            if (available.length === 0) { alert("Game Complete!"); visited.clear(); score = 0; startRound(); return; }

            currentTargetAbbr = available[Math.floor(Math.random() * available.length)];
            visited.add(currentTargetAbbr);
            
            currentPhase = "MAP_SELECTION";
            cityStrikes = 0;
            resetZoom();
            d3.selectAll(".state").classed("active-focused", false);
            d3.selectAll(".city-node").remove();
            document.getElementById("fact-overlay").classList.remove("show");

            updatePrompt(`Locate ${gameData[currentTargetAbbr].name}`, "Tap the state on the map");
            document.getElementById("target-state").innerText = currentTargetAbbr;
        }

        function handleStateClick(event, d) {
            if (currentPhase !== "MAP_SELECTION") return;
            const clickedId = this.id;
            const clickedAbbr = clickedId ? clickedId.replace("state-", "") : null;

            if (clickedAbbr === currentTargetAbbr) {
                flashState(this, "correct");
                transitionToCityPhase(d, clickedAbbr);
            } else {
                flashState(this, "wrong");
                const wrongName = gameData[clickedAbbr] ? gameData[clickedAbbr].name : "unknown territory";
                const targetName = gameData[currentTargetAbbr].name;
                updatePrompt(`Find ${targetName}`, `That is <span class="wrong-state-highlight">${wrongName}</span>`);
            }
        }

        function transitionToCityPhase(geoData, abbr) {
            currentPhase = "CITY_SELECTION";
            zoomToState(geoData);
            d3.select(`#state-${abbr}`).classed("active-focused", true);
            updatePrompt("Strategic Target", `Find the Capital of ${gameData[abbr].name}`);
            plotCities(abbr);

            setTimeout(() => {
                d3.selectAll(".city-node").style("pointer-events", "auto");
            }, 800);
        }

        function plotCities(abbr) {
            const data = gameData[abbr];
            const nodes = Object.entries(data.cities).map(([name, coords]) => {
                const projected = projection(coords);
                return projected ? { name, x: projected[0], y: projected[1] } : null;
            }).filter(n => n);

            g.selectAll(".city-node").data(nodes).enter().append("circle")
                .attr("class", "city-node").attr("cx", d => d.x).attr("cy", d => d.y).attr("r", 0)
                .on("mouseover", showTooltip).on("mousemove", moveTooltip).on("mouseout", hideTooltip)
                .on("click", (e, d) => handleCityClick(e, d, abbr))
                .transition().duration(500).delay(400).attr("r", 6 / currentScale);
        }

        function handleCityClick(event, cityNode, abbr) {
            const data = gameData[abbr];
            const isCorrect = cityNode.name === data.capital;
            const dot = d3.select(event.currentTarget);

            if (isCorrect) {
                dot.classed("correct-choice", true);
                score += (100 - (cityStrikes * 30));
                document.getElementById("score-val").innerText = score;
                showFact(cityNode.name, abbr, "CORRECT", "status-correct");
            } else {
                dot.classed("wrong-choice", true);
                cityStrikes++;
                showFact(cityNode.name, abbr, "NOT THE CAPITAL", "status-wrong");
            }
        }

        function showFact(cityName, abbr, status, statusClass) {
            const data = gameData[abbr];
            const overlay = document.getElementById("fact-overlay");
            const btn = document.getElementById("next-action-btn");
            
            document.getElementById("fact-status").innerText = status;
            document.getElementById("fact-status").className = `fact-status ${statusClass}`;
            document.getElementById("fact-city-name").innerText = cityName;
            
            let factText = data.facts[cityName] || "No data available for this sector.";
            document.getElementById("fact-text").innerHTML = factText;

            btn.innerText = (status === "CORRECT") ? "Next Mission" : "Try Again";
            btn.onclick = (status === "CORRECT") ? resetGameRound : () => overlay.classList.remove("show");

            overlay.classList.add("show");
        }

        function showTooltip(e, d) { const tt = document.getElementById("city-tooltip"); tt.innerText = d.name; tt.style.opacity = 1; }
        function moveTooltip(e) { const tt = document.getElementById("city-tooltip"); tt.style.left = e.pageX + "px"; tt.style.top = e.pageY + "px"; }
        function hideTooltip() { document.getElementById("city-tooltip").style.opacity = 0; }
        function resetGameRound() { startRound(); }

        function zoomToState(d) {
            const b = path.bounds(d);
            const s = Math.max(1, Math.min(10, 0.7 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height)));
            const t = [width / 2 - s * (b[0][0] + b[1][0]) / 2, height / 2 - s * (b[0][1] + b[1][1]) / 2];
            svg.transition().duration(1000).call(zoom.transform, d3.zoomIdentity.translate(t[0], t[1]).scale(s));
        }

        function resetZoom() { svg.transition().duration(1000).call(zoom.transform, d3.zoomIdentity); }
        function flashState(el, type) { d3.select(el).classed(type+"-flash", true); setTimeout(() => d3.select(el).classed(type+"-flash", false), 500); }
        function updatePrompt(m, s) { document.getElementById("main-prompt").innerHTML = m; document.getElementById("sub-prompt").innerHTML = s; }
    </script>
</body>
</html>
